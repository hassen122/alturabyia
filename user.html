<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø­ÙˆØ« Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ© </title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: radial-gradient(circle at center, #2c5364, #203a43, #0f2027); 
            margin: 0; direction: rtl; color: white; min-height: 100vh; background-attachment: fixed;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø·ÙˆØ± */
        .header { 
            display: flex; flex-direction: column; background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 30px 20px; border-bottom: 2px solid rgba(212, 175, 55, 0.3);
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 25px; }

        .home-btn {
            background: rgba(212, 175, 55, 0.15); color: #d4af37; border: 1px solid #d4af37;
            padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 0.85rem; font-weight: bold;
        }

        .inner-search { 
            width: 110px; padding: 8px 30px 8px 10px; border-radius: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            background: rgba(255, 255, 255, 0.1) url('https://cdn-icons-png.flaticon.com/512/622/622669.png') no-repeat right 10px center;
            background-size: 14px; color: white; font-size: 0.8rem; outline: none; 
        }

        .quote-box {
            text-align: center; max-width: 600px; margin: 0 auto; background: rgba(0, 0, 0, 0.3);
            padding: 20px; border-radius: 20px; border: 1px dashed rgba(212, 175, 55, 0.4);
        }

        .quran-text { margin: 15px 0 0 0; font-size: 1.2rem; font-weight: bold; color: #d4af37; text-shadow: 0 0 8px rgba(212, 175, 55, 0.3); }

        .cat-list { display: flex; flex-direction: column; align-items: center; padding: 25px; gap: 15px; }

        .btn-cat { 
            width: 100%; max-width: 400px; padding: 18px; background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); 
            color: #d4af37; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; 
        }

        .res-view { width: 92%; max-width: 700px; margin: 0 auto; display: none; padding-bottom: 40px; }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ø±Ø¯ Ù„ÙŠØ¸Ù‡Ø± ÙƒØ²Ø± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¶ØºØ· */
        .card { 
            padding: 20px; border-radius: 15px; background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 15px; 
            cursor: pointer; transition: 0.3s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .card:hover { background: rgba(212, 175, 55, 0.1); border-color: rgba(212, 175, 55, 0.4); transform: translateX(-5px); }

        .card h3 { color: #d4af37; font-size: 1rem; margin: 0; flex: 1; }
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© ØµØºÙŠØ±Ø© ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ­ */
        .card::after { content:''; font-size: 1.2rem; opacity: 0.7; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px);
            z-index: 1000; justify-content: center; align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e3c4a, #152930);
            width: 90%; max-width: 600px; max-height: 85vh;
            border-radius: 20px; border: 1px solid #d4af37;
            padding: 25px; position: relative;
            overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: slideUp 0.4s ease;
        }

        .modal-header { font-size: 1.3rem; color: #d4af37; font-weight: bold; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed rgba(255,255,255,0.2); }
        .modal-body { font-size: 1.1rem; line-height: 1.8; color: #f0f0f0; white-space: pre-wrap; text-align: justify; }
        
        .close-modal {
            position: absolute; top: 15px; left: 15px;
            background: rgba(255,255,255,0.1); border: none; color: #fff;
            width: 35px; height: 35px; border-radius: 50%;
            font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .close-modal:hover { background: #d4af37; color: #000; }

        /* Ø²Ø± Ø¨Ø­Ø« Ø¬ÙˆØ¬Ù„ Ø§Ù„Ù…Ø®ØµØµ */
        .google-search-btn {
            display: block; width: 100%; margin-top: 20px; padding: 12px;
            background: rgba(66, 133, 244, 0.2); border: 1px solid #4285f4; color: white;
            border-radius: 12px; cursor: pointer; text-align: center; text-decoration: none;
            font-size: 0.85rem; font-weight: bold; transition: 0.3s;
        }
        .google-search-btn:hover { background: rgba(66, 133, 244, 0.4); }

        .highlight { background: rgba(212, 175, 55, 0.4); color: white; padding: 0 2px; border-radius: 3px; }
        .back-btn { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 10px; margin: 15px 0; cursor: pointer; font-size: 0.85rem; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div class="header" id="mainH">
    <div class="header-top">
        <a class="home-btn" href="index.html">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <h2 style="margin:0; font-size: 1.1rem; color: #d4af37;">Ø¨Ø­ÙˆØ« Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ©</h2>
        <input type="text" id="mainSearch" class="inner-search" placeholder="Ø¨Ø­Ø«..." oninput="init()">
    </div>

    <div class="quote-box">
        <p class="quote-text">Ø£Ø¨ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù… Ù‚Ø§Ù„: Ù„ÙˆØ¯Ø¯Øª Ø£Ù† Ø£ØµØ­Ø§Ø¨ÙŠ Ø¶Ø±Ø¨Øª Ø±Ø¤ÙˆØ³Ù‡Ù… Ø¨Ø§Ù„Ø³ÙŠØ§Ø· Ø­ØªÙ‰ ÙŠØªÙÙ‚Ù‡ÙˆØ§</p>
        <div style="margin: 12px auto; height: 1px; width: 50%; background: linear-gradient(90deg, transparent, #d4af37, transparent);"></div>
        <p class="quran-text">Ù„ÙØ°ÙÙƒÙ’Ø±ÙÙ‰ Ù„ÙÙ…ÙÙ†Ù’ ÙƒÙØ§Ù†Ù Ù„ÙÙ‡Ù Ù‚ÙÙ„Ù’Ø¨ÙŒ</p>
    </div>
</div>

<div id="view1" class="cat-list"><p>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>

<div id="view2" class="res-view">
    <button class="back-btn" onclick="showV1()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</button>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <input type="text" id="innerSearch" 
               style="width:220px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.2); background:rgba(0,0,0,0.3); color:white; outline:none; font-size: 0.85rem;" 
               placeholder="ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©...">
    </div>

    <div id="output"></div>
</div>

<div id="contentModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content">
        <button class="close-modal" onclick="forceClose()">âœ•</button>
        <div id="modalTitle" class="modal-header"></div>
        <div id="modalBody" class="modal-body"></div>
        <a id="googleBtn" href="#" target="_blank" class="google-search-btn" style="display: none;">
            Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±ÙˆØ§ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø± (Google) ğŸŒ
        </a>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA3Qp8zzy6FIs1g5ed0HXBkd9FykxGvGR8",
        authDomain: "alturbya.firebaseapp.com",
        projectId: "alturbya",
        storageBucket: "alturbya.firebasestorage.app",
        messagingSenderId: "481479317412",
        appId: "1:481479317412:web:8f070dbc4c87ba5aa59331"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const firestore = firebase.firestore();

    let dbData = {}; 
    let currentCategory = "";

    function normalizeArabic(text) {
        if (!text) return "";
        return text.replace(/[\u064B-\u0652]/g, "").replace(/[Ø£Ø¢Ø¥]/g, "Ø§").replace(/Ø©/g, "Ù‡").replace(/Ù‰/g, "ÙŠ").toLowerCase().trim();
    }

    firestore.collection("researches").onSnapshot((snapshot) => {
        let tempDB = {};
        snapshot.forEach(doc => {
            const item = doc.data();
            const cat = item.category || "Ø¹Ø§Ù…";
            if (!tempDB[cat]) tempDB[cat] = [];
            tempDB[cat].push(item);
        });
        dbData = tempDB;
        init();
    });

    function init() {
        const v1 = document.getElementById('view1'); 
        v1.innerHTML = '';
        Object.keys(dbData).forEach(c => {
            const b = document.createElement('button');
            b.className = 'btn-cat';
            b.innerText = c;
            b.onclick = () => showV2(c);
            v1.appendChild(b);
        });
    }

    function showV2(c) {
        currentCategory = c;
        document.getElementById('view1').style.display = 'none';
        document.getElementById('mainH').style.display = 'none';
        document.getElementById('view2').style.display = 'block';
        renderResearches(dbData[c]);
    }

    function renderResearches(data, term = "") {
        const out = document.getElementById('output');
        out.innerHTML = `<h2 style="color:#d4af37; text-align:center; margin-bottom:20px;">${currentCategory}</h2>`;
        
        if (!data) return;

        const cleanTerm = normalizeArabic(term);
        
        data.forEach(r => {
            // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø­Ø«: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
            if(cleanTerm && !normalizeArabic(r.t).includes(cleanTerm) && !normalizeArabic(r.x).includes(cleanTerm)) return;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø¹Ù†ÙˆØ§Ù† ÙÙ‚Ø·)
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<h3>${r.t}</h3>`; // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙ‚Ø·
            
            // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·ØŒ Ù†ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
            div.onclick = () => openModal(r.t, r.x, term);
            
            out.appendChild(div);
        });
    }

    // ÙˆØ¸ÙŠÙØ© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function openModal(title, content, searchTerm) {
        const modal = document.getElementById('contentModal');
        const mTitle = document.getElementById('modalTitle');
        const mBody = document.getElementById('modalBody');
        const gBtn = document.getElementById('googleBtn');

        mTitle.innerText = title;

        // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¨Ø­ÙˆØ« Ø¹Ù†Ù‡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø§ÙØ°Ø©
        let displayText = content;
        if(searchTerm && searchTerm.length > 1) {
            const reg = new RegExp(`(${searchTerm.split('').join('[\\u064B-\\u0652]*')})`, "gi");
            displayText = displayText.replace(reg, '<span class="highlight">$1</span>');
        }
        mBody.innerHTML = displayText;

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø²Ø± Ø¬ÙˆØ¬Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø§ÙØ°Ø©
        if(searchTerm && searchTerm.length > 2) {
            gBtn.style.display = "block";
            const sites = "site:shiaonlinelibrary.com OR site:al-rafed.net OR site:hodaalquran.com";
            gBtn.href = `https://www.google.com/search?q=${encodeURIComponent(searchTerm)} ${sites}`;
        } else {
            gBtn.style.display = "none";
        }

        modal.style.display = 'flex';
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function closeModal(e) {
        if (e.target.id === 'contentModal') {
            document.getElementById('contentModal').style.display = 'none';
        }
    }
    function forceClose() {
        document.getElementById('contentModal').style.display = 'none';
    }

    document.getElementById('innerSearch').oninput = function(e) {
        renderResearches(dbData[currentCategory], e.target.value);
    };

    function showV1() {
        document.getElementById('view1').style.display = 'flex';
        document.getElementById('mainH').style.display = 'flex';
        document.getElementById('view2').style.display = 'none';
    }
</script>
</body>
</html>
