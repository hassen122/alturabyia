<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø­ÙˆØ« Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ© </title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: radial-gradient(circle at center, #2c5364, #203a43, #0f2027); 
            margin: 0; 
            direction: rtl; 
            color: white; 
            min-height: 100vh;
            background-attachment: fixed;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø·ÙˆØ± */
        .header { 
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 30px 20px; 
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }

        .home-btn {
            background: rgba(212, 175, 55, 0.15);
            color: #d4af37;
            border: 1px solid #d4af37;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: bold;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„ÙˆÙŠ - Ø«Ø§Ø¨Øª ÙˆØµØºÙŠØ± Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù„Ù…Ø³ */
        .inner-search { 
            width: 110px; 
            padding: 8px 30px 8px 10px;
            border-radius: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            background: rgba(255, 255, 255, 0.1) url('https://cdn-icons-png.flaticon.com/512/622/622669.png') no-repeat right 10px center;
            background-size: 14px;
            color: white;
            font-size: 0.8rem; 
            outline: none; 
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù†Øµ Ø§Ù„Ø´Ø±ÙŠÙ */
        .quote-box {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 20px;
            border: 1px dashed rgba(212, 175, 55, 0.4);
            position: relative;
        }

        .quote-text {
            margin: 0;
            font-size: 1rem;
            line-height: 1.7;
            color: #fff;
            font-style: italic;
        }

        .quran-text {
            margin: 15px 0 0 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: #d4af37;
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        }

        .cat-list { display: flex; flex-direction: column; align-items: center; padding: 25px; gap: 15px; }

        .btn-cat { 
            width: 100%; 
            max-width: 400px; 
            padding: 18px; 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); 
            color: #d4af37; 
            border-radius: 15px; 
            font-size: 1.1rem; 
            font-weight: bold; 
            cursor: pointer; 
            transition: 0.2s; 
        }

        .btn-cat:active { transform: scale(0.98); background: rgba(255, 255, 255, 0.1); }

        .res-view { width: 92%; max-width: 700px; margin: 0 auto; display: none; padding-bottom: 40px; }

        .card { 
            padding: 20px; 
            border-radius: 15px; 
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px; 
        }

        .card h3 { color: #d4af37; font-size: 1rem; border-bottom: 1px solid rgba(212, 175, 55, 0.2); padding-bottom: 8px; margin-top: 0; }
        .card p { font-size: 0.95rem; line-height: 1.7; color: #eee; margin-bottom: 0; white-space: pre-wrap; }
        
        .highlight { background: rgba(212, 175, 55, 0.4); color: white; padding: 0 2px; border-radius: 3px; }
        .back-btn { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 10px; margin: 15px 0; cursor: pointer; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="header" id="mainH">
    <div class="header-top">
        <a class="home-btn" href="index.html">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <h2 style="margin:0; font-size: 1.1rem; color: #d4af37;">Ø¨Ø­ÙˆØ« Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ©</h2>
        <input type="text" id="mainSearch" class="inner-search" placeholder="Ø¨Ø­Ø«..." oninput="init()">
    </div>

    <div class="quote-box">
        <p class="quote-text">
            Ø£Ø¨ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù… Ù‚Ø§Ù„: Ù„ÙˆØ¯Ø¯Øª Ø£Ù† Ø£ØµØ­Ø§Ø¨ÙŠ Ø¶Ø±Ø¨Øª Ø±Ø¤ÙˆØ³Ù‡Ù… Ø¨Ø§Ù„Ø³ÙŠØ§Ø· Ø­ØªÙ‰ ÙŠØªÙÙ‚Ù‡ÙˆØ§
        </p>
        <div style="margin: 12px auto; height: 1px; width: 50%; background: linear-gradient(90deg, transparent, #d4af37, transparent);"></div>
        <p class="quran-text">Ù„ÙØ°ÙÙƒÙ’Ø±ÙÙ‰ Ù„ÙÙ…ÙÙ†Ù’ ÙƒÙØ§Ù†Ù Ù„ÙÙ‡Ù Ù‚ÙÙ„Ù’Ø¨ÙŒ</p>
    </div>
</div>

<div id="view1" class="cat-list">
    <p>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø­ÙˆØ«...</p>
</div>

<div id="view2" class="res-view">
    <button class="back-btn" onclick="showV1()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</button>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <input type="text" id="innerSearch" 
               style="width:220px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.2); background:rgba(0,0,0,0.3); color:white; outline:none; font-size: 0.85rem;" 
               placeholder="ğŸ” Ø¨Ø­Ø« Ø§Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ©  ...">
    </div>

    <div id="output"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA3Qp8zzy6FIs1g5ed0HXBkd9FykxGvGR8",
        authDomain: "alturbya.firebaseapp.com",
        projectId: "alturbya",
        storageBucket: "alturbya.firebasestorage.app",
        messagingSenderId: "481479317412",
        appId: "1:481479317412:web:8f070dbc4c87ba5aa59331"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const firestore = firebase.firestore();

    let dbData = {}; 
    let currentCategory = "";

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ: ØªØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ´ÙƒÙŠÙ„ ÙˆØ§Ù„Ù‡Ù…Ø²Ø§Øª
    function normalizeArabic(text) {
        if (!text) return "";
        return text
            .replace(/[\u064B-\u0652]/g, "") 
            .replace(/[Ø£Ø¢Ø¥]/g, "Ø§")           
            .replace(/Ø©/g, "Ù‡")              
            .replace(/Ù‰/g, "ÙŠ")              
            .toLowerCase().trim();
    }

    firestore.collection("researches").onSnapshot((snapshot) => {
        let tempDB = {};
        snapshot.forEach(doc => {
            const item = doc.data();
            const cat = item.category || "Ø¹Ø§Ù…";
            if (!tempDB[cat]) tempDB[cat] = [];
            tempDB[cat].push(item);
        });
        dbData = tempDB;
        init();
        if (currentCategory && document.getElementById('view2').style.display === 'block') {
            renderResearches(dbData[currentCategory] || []);
        }
    });

    function init() {
        const v1 = document.getElementById('view1'); 
        v1.innerHTML = '';
        const keys = Object.keys(dbData);
        const filter = normalizeArabic(document.getElementById('mainSearch').value);
        
        keys.forEach(c => {
            if (filter && !normalizeArabic(c).includes(filter)) return;
            const b = document.createElement('button');
            b.className = 'btn-cat';
            b.innerText = c;
            b.onclick = () => showV2(c);
            v1.appendChild(b);
        });
    }

    function showV2(c) {
        currentCategory = c;
        document.getElementById('view1').style.display = 'none';
        document.getElementById('mainH').style.display = 'none';
        document.getElementById('view2').style.display = 'block';
        document.getElementById('innerSearch').value = '';
        renderResearches(dbData[c]);
        window.scrollTo(0,0);
    }

    function renderResearches(data, term = "") {
        const out = document.getElementById('output');
        out.innerHTML = `<h2 style="color:#d4af37; text-align:center; font-size: 1.3rem; margin-bottom: 20px;">${currentCategory}</h2>`;
        
        if (!data) return;
        const cleanTerm = normalizeArabic(term);

        data.forEach(r => {
            const cleanTitle = normalizeArabic(r.t);
            const cleanText = normalizeArabic(r.x);

            if(cleanTerm && !cleanTitle.includes(cleanTerm) && !cleanText.includes(cleanTerm)) return;
            
            let displayText = r.x;
            if(term && term.length > 1) {
                const reg = new RegExp(`(${term.split('').join('[\\u064B-\\u0652]*')})`, "gi");
                displayText = displayText.replace(reg, '<span class="highlight">$1</span>');
            }

            out.innerHTML += `
                <div class="card">
                    <h3>${r.t}</h3>
                    <p>${displayText}</p>
                </div>`;
        });
    }

    document.getElementById('innerSearch').oninput = function(e) {
        renderResearches(dbData[currentCategory], e.target.value);
    };

    function showV1() {
        document.getElementById('view1').style.display = 'flex';
        document.getElementById('mainH').style.display = 'flex';
        document.getElementById('view2').style.display = 'none';
    }
</script>
</body>
</html>
